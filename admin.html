<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OA Kyrgyz Organic - Admin Panel</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            background: #f0f2f5;
            padding-bottom: 50px;
        }

        .admin-header {
            background: #333;
            color: white;
            padding: 1rem 0;
            margin-bottom: 2rem;
        }

        .admin-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .admin-title {
            margin-bottom: 0.5rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            border-bottom: 2px solid #ddd;
        }

        .tab-btn {
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            color: var(--color-primary);
            border-color: var(--color-primary);
        }

        /* Content Areas */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Forms & Lists */
        .admin-card {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .form-control {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
        }

        .btn-danger {
            background: #e53935;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .btn-success {
            background: #43a047;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            margin-top: 1rem;
            display: inline-block;
        }

        .item-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: #f9f9f9;
            border-radius: 4px;
            border: 1px solid #eee;
        }

        .alert-box {
            background: #e3f2fd;
            color: #0d47a1;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 2rem;
            border: 1px solid #bbdefb;
        }
    </style>
</head>

<body>

    <header class="admin-header">
        <div class="admin-container">
            <h1 class="admin-title">Content Manager</h1>
            <p>Manage website content without code.</p>
        </div>
    </header>

    <div class="admin-container">

        <div class="alert-box">
            <strong>⚠️ IMPORTANT INSTRUCTION:</strong><br>
            Since this is a static website, saving changes works by <strong>Downloading</strong> a new data file.<br>
            After you click "Download JSON", you MUST manually move the downloaded file to the <code>/data</code> folder
            in your project, replacing the old one.
        </div>

        <div class="tabs">
            <div class="tab-btn active" onclick="switchTab('products')">Products</div>
            <div class="tab-btn" onclick="switchTab('categories')">Categories</div>
            <div class="tab-btn" onclick="switchTab('banners')">Banners</div>
        </div>

        <!-- PRODUCTS TAB -->
        <div id="products" class="tab-content active">
            <div class="admin-card">
                <h3 id="formTitle">Add New Product</h3>
                <form id="productForm">
                    <input type="hidden" id="pIndex" value="-1"> <!-- Hidden index for editing -->
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" id="pName" class="form-control" required>
                    </div>
                    <div class="form-group" style="display: flex; gap: 1rem;">
                        <div style="flex: 1;">
                            <label>Price (e.g. 100 KGS)</label>
                            <input type="text" id="pPrice" class="form-control" required>
                        </div>
                        <div style="flex: 1;">
                            <label>Weight (e.g. 500g)</label>
                            <input type="text" id="pWeight" class="form-control" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select id="pCategory" class="form-control"></select>
                    </div>
                    <div class="form-group">
                        <label>Image URL</label>
                        <input type="text" id="pImage" class="form-control" placeholder="https://..."
                            value="https://placehold.co/400x300">
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="pDesc" class="form-control" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="pFeatured"> Set as "Featured / Hit of the Week"
                        </label>
                    </div>
                    <div style="display: flex; gap: 1rem;">
                        <button type="submit" id="saveBtn" class="btn-primary">Add Product</button>
                        <button type="button" id="cancelBtn" class="btn-danger" style="background: #777; display: none;"
                            onclick="resetForm()">Cancel</button>
                    </div>
                </form>
            </div>

            <div class="admin-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>All Products</h3>
                    <button class="btn-success" onclick="downloadJSON('products', productsData)">⬇ Download
                        products.json</button>
                </div>
                <div id="productList" class="item-list"></div>
            </div>
        </div>

        <!-- CATEGORIES TAB -->
        <div id="categories" class="tab-content">
            <div class="admin-card">
                <h3>Add Category</h3>
                <form id="categoryForm" style="display: flex; gap: 1rem;">
                    <input type="text" id="cName" class="form-control" placeholder="New Category Name" required>
                    <button type="submit" class="btn-primary">Add</button>
                </form>
            </div>
            <div class="admin-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>Existing Categories</h3>
                    <button class="btn-success" onclick="downloadJSON('categories', categoriesData)">⬇ Download
                        categories.json</button>
                </div>
                <div id="categoryList" class="item-list"></div>
            </div>
        </div>

        <!-- BANNERS TAB -->
        <div id="banners" class="tab-content">
            <div class="admin-card">
                <h3>Edit Banners</h3>
                <p style="color: #666; font-size: 0.9rem; margin-bottom: 1rem;">Change the text or image URL for the
                    homepage slider.</p>
                <div id="bannerList" class="item-list"></div>
                <button class="btn-success" onclick="downloadJSON('banner', bannerData)">⬇ Download banner.json</button>
            </div>
        </div>

    </div>

    <script>
        // State
        let productsData = [];
        let categoriesData = [];
        let bannerData = [];

        // Init
        async function init() {
            await loadData();
            renderAll();
        }

        async function loadData() {
            try {
                const [pRes, cRes, bRes] = await Promise.all([
                    fetch('data/products.json'),
                    fetch('data/categories.json'),
                    fetch('data/banner.json')
                ]);
                productsData = await pRes.json();
                categoriesData = await cRes.json();
                bannerData = await bRes.json();
            } catch (e) {
                console.error("Error loading data", e);
                alert("Could not load data. Make sure /data/*.json files exist.");
            }
        }

        function renderAll() {
            renderProducts();
            renderCategories();
            renderBanners();
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }

        // --- PRODUCTS ---
        function renderProducts() {
            const list = document.getElementById('productList');
            list.innerHTML = '';
            productsData.forEach((p, index) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <div>
                        <strong>${p.name}</strong> <span style="font-size: 0.8rem; color: #777;">(${p.category})</span>
                        ${p.isFeatured ? '<span style="color: orange; font-size: 0.8rem;">★ Hit</span>' : ''}
                    </div>
                    <div>
                        <button class="btn-primary" style="background: #2196f3; font-size: 0.8rem; padding: 0.25rem 0.5rem;" onclick="editProduct(${index})">Edit</button>
                        <button class="btn-danger" onclick="deleteProduct(${index})">Delete</button>
                    </div>
                `;
                list.appendChild(div);
            });

            // Populate Category Select
            const select = document.getElementById('pCategory');
            // Save current selection if re-rendering during edit? No, usually fine.
            const currentVal = select.value;
            select.innerHTML = '<option value="">Select Category...</option>';
            categoriesData.forEach(c => {
                const opt = document.createElement('option');
                opt.value = c;
                opt.textContent = c;
                select.appendChild(opt);
            });
            if (currentVal) select.value = currentVal;
        }

        function editProduct(index) {
            const p = productsData[index];
            document.getElementById('pIndex').value = index;
            document.getElementById('pName').value = p.name;
            document.getElementById('pPrice').value = p.price;
            document.getElementById('pWeight').value = p.weight;
            document.getElementById('pCategory').value = p.category;
            document.getElementById('pImage').value = p.image;
            document.getElementById('pDesc').value = p.description;
            document.getElementById('pFeatured').checked = p.isFeatured;

            // UI Mode Update
            document.getElementById('formTitle').textContent = "Edit Product";
            document.getElementById('saveBtn').textContent = "Update Product";
            document.getElementById('cancelBtn').style.display = "inline-block";

            // Scroll to form
            document.getElementById('productForm').scrollIntoView({ behavior: 'smooth' });
        }

        function resetForm() {
            document.getElementById('productForm').reset();
            document.getElementById('pIndex').value = "-1";
            document.getElementById('formTitle').textContent = "Add New Product";
            document.getElementById('saveBtn').textContent = "Add Product";
            document.getElementById('cancelBtn').style.display = "none";
        }

        document.getElementById('productForm').addEventListener('submit', (e) => {
            e.preventDefault();

            const indexStr = document.getElementById('pIndex').value;
            const index = parseInt(indexStr);

            const productData = {
                id: index >= 0 ? productsData[index].id : Date.now(),
                name: document.getElementById('pName').value,
                price: document.getElementById('pPrice').value,
                weight: document.getElementById('pWeight').value,
                category: document.getElementById('pCategory').value,
                image: document.getElementById('pImage').value,
                description: document.getElementById('pDesc').value,
                isFeatured: document.getElementById('pFeatured').checked
            };

            if (index >= 0) {
                // Update
                productsData[index] = productData;
                alert("Product Updated! Remember to Download.");
            } else {
                // Add
                productsData.push(productData);
                alert("Product Added! Remember to Download.");
            }

            renderProducts();
            resetForm();
        });

        function deleteProduct(index) {
            if (confirm('Delete this product?')) {
                productsData.splice(index, 1);
                renderProducts();
            }
        }

        // --- CATEGORIES ---
        function renderCategories() {
            const list = document.getElementById('categoryList');
            list.innerHTML = '';
            categoriesData.forEach((c, index) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <span>${c}</span>
                    <button class="btn-danger" onclick="deleteCategory(${index})">Delete</button>
                `;
                list.appendChild(div);
            });
        }

        document.getElementById('categoryForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const val = document.getElementById('cName').value;
            if (val) {
                categoriesData.push(val);
                renderCategories();
                document.getElementById('cName').value = '';
            }
        });

        function deleteCategory(index) {
            if (confirm('Delete this category?')) {
                categoriesData.splice(index, 1);
                renderCategories();
                renderProducts(); // Update select
            }
        }

        // --- BANNERS ---
        function renderBanners() {
            const list = document.getElementById('bannerList');
            list.innerHTML = '';
            bannerData.forEach((b, index) => {
                const div = document.createElement('div');
                div.className = 'admin-card';
                div.innerHTML = `
                    <h4>Slide ${index + 1}</h4>
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" class="form-control" value="${b.title.replace(/"/g, '&quot;')}" onchange="updateBanner(${index}, 'title', this.value)">
                    </div>
                    <div class="form-group">
                        <label>Subtitle</label>
                        <input type="text" class="form-control" value="${b.subtitle.replace(/"/g, '&quot;')}" onchange="updateBanner(${index}, 'subtitle', this.value)">
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function updateBanner(index, field, value) {
            bannerData[index][field] = value;
        }

        // --- DOWNLOAD ---
        function downloadJSON(filename, data) {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data, null, 4));
            const anchor = document.createElement('a');
            anchor.setAttribute("href", dataStr);
            anchor.setAttribute("download", filename + ".json");
            document.body.appendChild(anchor);
            anchor.click();
            anchor.remove();
        }

        init();
    </script>
</body>

</html>